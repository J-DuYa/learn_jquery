#### 添加promise对象

1. 内部创建一个promise对象
2. deferred对象里的属性只保留触发Callback回调的属性resolve | reject | notify | resolveWith | rejectWith | notifyWith
3. deferred对象的其它属性作为promise对象的属性
4. 把promise对象的所有属性合并到deferred对象上
5. deferred.promise()返回一个promise对象。

```javascript
jQuery.extend({
	Deferred: function () {
		var tuples = [
				["resolve", "done", jQuery.Callbacks("once memory"), "resolved"],
				["reject", "fail", jQuery.Callbacks("once memory"), "rejected"],
				["notify", "progress", jQuery.Callbacks("memory")]
			],
			state = "pending",
			promise = {
				// state作为promise的属性
				state: function () {
					return state;
				},
				// 如果参数为空返回promise对象
				// 如果obj不为空会把obj合并到deferred对象，并返回这个新的对象
				promise: function (obj) {
					return obj != null ? jQuery.extend(obj, promise) : promise;
				}
			},
			deferred = {};

		jQuery.each(tuples, function (i, tuple) {
			var list = tuple[2],
				stateString = tuple[ 3 ];

			// promise[ done | fail | progress ] = jQuery.Callbacks.add
			promise[tuple[1]] = list.add;

			if (stateString) {
				list.add(function () {
					state = stateString;
				});
			}

			deferred[tuple[0]] = function () {
				deferred[tuple[0] + "With"](this, arguments);
				return this;
			}

			deferred[tuple[0] + "With"] = list.fireWith;

		});

		// 把promise对象的属性合并到deferred对象上
		promise.promise(deferred);

		return deferred;
	}
});
```