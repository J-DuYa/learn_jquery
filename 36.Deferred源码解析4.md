#### Deferred.then()的实现


```javascript
var dtd = $.Deferred();

var fnDone = function (value) {
	console.log("done:" + value);
};

var fnFail = function (value) {
	console.log("fail:" + value);
};

dtd.then(fnDone, fnFail);
dtd.resolve("a");	// done:a
// dtd.reject("b");	// fail:b
```

* deferred.then(fnDone, fnFail)是通过内部调用done,fail来实现的，即deferred.done(fnDone),deferred.fail(fnFail)

```javascript
jQuery.extend({
	Deferred: function (func) {
		var tuples = [
				["resolve", "done", jQuery.Callbacks("once memory"), "resolved"],
				["reject", "fail", jQuery.Callbacks("once memory"), "rejected"],
				["notify", "progress", jQuery.Callbacks("memory")]
			],
			promise = {
				then: function (/* fnDone, fnFail, fnProgress */) {
					// fns = [fnDone, fnFail, fnProgress]
					var fns = arguments;
					return jQuery.Deferred(function (newDefer) {
						jQuery.each(tuples, function (i, tuple) {
							// fn = fnDone | fnFail | fnProgress
							var fn = jQuery.isFunction(fns[i]) && fns[i];

							// deferred.done(fnDone) | deferred.fail(fnFail) | deferred.progress(fnProgress)
							deferred[tuple[1]](fn);
						});
					}).promise();
				}
			},
			deferred = {};

		return deferred;
	}
});
```

